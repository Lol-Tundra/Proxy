<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Web Proxy Browser</title>
<style>
body { margin:0; font-family:sans-serif; }
.browser-container { display:flex; flex-direction:column; height:100vh; }
.browser-header { display:flex; padding:8px; background:#f1f3f4; align-items:center; gap:4px; }
.address-bar { flex:1; padding:6px 8px; border-radius:4px; border:1px solid #ccc; font-size:14px; }
.go-btn { padding:6px 12px; cursor:pointer; border:none; border-radius:4px; background:#1a73e8; color:#fff; font-weight:500; }
.go-btn:hover { background:#1765cc; }
.nav-btn { padding:6px 10px; cursor:pointer; border:none; border-radius:4px; background:#e0e0e0; margin-right:2px; }
.nav-btn:hover { background:#d2d2d2; }
.tabs-bar { display:flex; align-items:center; padding:4px; background:#e8eaed; overflow-x:auto; }
.tab-btn { padding:6px 12px; margin-right:2px; border-radius:8px 8px 0 0; border:1px solid #ccc; border-bottom:none; background:#e8eaed; cursor:pointer; white-space:nowrap; font-weight:500; }
.tab-btn.active { background:#fff; border-bottom:1px solid #fff; }
#newTabBtn { font-weight:bold; background:#e8eaed; border:1px solid #ccc; border-bottom:none; }
#newTabBtn:hover { background:#d2d2d2; }
.iframe-container { flex:1; position:relative; }
.proxy-iframe { width:100%; height:100%; border:none; display:none; }
.home-screen { display:flex; flex-direction:column; align-items:center; justify-content:center; flex:1; color:#888; }
</style>
</head>
<body>
<div class="browser-container">
    <div class="browser-header">
        <button id="backBtn" class="nav-btn" disabled>‚Üê</button>
        <button id="forwardBtn" class="nav-btn" disabled>‚Üí</button>
        <input type="text" id="addressBar" class="address-bar" placeholder="Enter URL or search term">
        <button id="goBtn" class="go-btn">Go</button>
    </div>
    <div class="tabs-bar" id="tabsBar">
        <button id="newTabBtn" class="tab-btn">+</button>
    </div>
    <div class="iframe-container" id="iframeContainer">
        <div class="home-screen" id="homeScreen">üåê Enter a URL to get started</div>
    </div>
</div>

<script>
const addressBar = document.getElementById('addressBar');
const goBtn = document.getElementById('goBtn');
const tabsBar = document.getElementById('tabsBar');
const iframeContainer = document.getElementById('iframeContainer');
const homeScreen = document.getElementById('homeScreen');
const newTabBtn = document.getElementById('newTabBtn');
const backBtn = document.getElementById('backBtn');
const forwardBtn = document.getElementById('forwardBtn');

let tabs = [];
let activeTabIndex = -1;

function normalizeUrl(input) {
    input = input.trim();
    // If search query
    if (!input.includes('.') || input.includes(' ')) {
        return 'https://html.duckduckgo.com/' + encodeURIComponent(input);
    }
    if (!input.match(/^https?:\/\//)) input = 'https://' + input;
    return input;
}

function createTab(url) {
    const iframe = document.createElement('iframe');
    iframe.className = 'proxy-iframe';
    iframe.src = '/?url=' + encodeURIComponent(url);
    iframe.dataset.history = JSON.stringify([url]);
    iframe.dataset.index = '0';

    iframeContainer.appendChild(iframe);

    const tabBtn = document.createElement('button');
    tabBtn.className = 'tab-btn';
    const textSpan = document.createElement('span');
    textSpan.textContent = url;
    const closeBtn = document.createElement('span');
    closeBtn.textContent = ' √ó';
    closeBtn.style.marginLeft = '4px';
    closeBtn.style.cursor = 'pointer';
    closeBtn.onclick = (e) => { e.stopPropagation(); closeTab(tab); };
    tabBtn.appendChild(textSpan);
    tabBtn.appendChild(closeBtn);
    tabBtn.onclick = () => switchTab(tabs.indexOf(tab));

    tabsBar.insertBefore(tabBtn, newTabBtn);

    const tab = { url, iframe, tabBtn, history: [url], historyIndex: 0 };
    tabs.push(tab);
    switchTab(tabs.length - 1);
}

function switchTab(index) {
    tabs.forEach((tab, i) => {
        tab.iframe.style.display = i === index ? 'block' : 'none';
        tab.tabBtn.classList.toggle('active', i === index);
    });
    activeTabIndex = index;
    homeScreen.style.display = 'none';
    updateNavButtons();
}

function closeTab(tab) {
    const index = tabs.indexOf(tab);
    if (index === -1) return;
    iframeContainer.removeChild(tab.iframe);
    tabsBar.removeChild(tab.tabBtn);
    tabs.splice(index, 1);

    if (activeTabIndex === index) {
        if (tabs.length > 0) switchTab(index > 0 ? index - 1 : 0);
        else {
            activeTabIndex = -1;
            homeScreen.style.display = 'flex';
        }
    } else if (activeTabIndex > index) activeTabIndex--;
    updateNavButtons();
}

function updateNavButtons() {
    if (activeTabIndex === -1) {
        backBtn.disabled = true;
        forwardBtn.disabled = true;
    } else {
        const tab = tabs[activeTabIndex];
        backBtn.disabled = tab.historyIndex <= 0;
        forwardBtn.disabled = tab.historyIndex >= tab.history.length - 1;
    }
}

function navigateCurrentTab(url) {
    if (activeTabIndex === -1) {
        createTab(url);
        return;
    }
    const tab = tabs[activeTabIndex];
    tab.history = tab.history.slice(0, tab.historyIndex + 1);
    tab.history.push(url);
    tab.historyIndex++;
    tab.iframe.src = '/?url=' + encodeURIComponent(url);
    tab.tabBtn.firstChild.textContent = url;
    updateNavButtons();
}

newTabBtn.onclick = () => createTab('https://html.duckduckgo.com/html/');

goBtn.addEventListener('click', () => {
    const url = normalizeUrl(addressBar.value);
    navigateCurrentTab(url);
});

addressBar.addEventListener('keypress', e => {
    if (e.key === 'Enter') {
        const url = normalizeUrl(addressBar.value);
        navigateCurrentTab(url);
    }
});

backBtn.onclick = () => {
    if (activeTabIndex === -1) return;
    const tab = tabs[activeTabIndex];
    if (tab.historyIndex > 0) {
        tab.historyIndex--;
        const url = tab.history[tab.historyIndex];
        tab.iframe.src = '/?url=' + encodeURIComponent(url);
        tab.tabBtn.firstChild.textContent = url;
        updateNavButtons();
    }
};

forwardBtn.onclick = () => {
    if (activeTabIndex === -1) return;
    const tab = tabs[activeTabIndex];
    if (tab.historyIndex < tab.history.length - 1) {
        tab.historyIndex++;
        const url = tab.history[tab.historyIndex];
        tab.iframe.src = '/?url=' + encodeURIComponent(url);
        tab.tabBtn.firstChild.textContent = url;
        updateNavButtons();
    }
};
</script>
</body>
</html>
